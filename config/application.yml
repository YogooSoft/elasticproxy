server:
  port: 8000
  # HTTPæœåŠ¡å™¨é…ç½® - æ”¯æŒå¤§è¯·æ±‚
  max-http-header-size: 65536  # 64KB HTTPå¤´å¤§å°é™åˆ¶
  netty:
    # è¯·æ±‚è§£ç é…ç½®
    max-initial-line-length: 8192  # 8KB åˆå§‹è¡Œé•¿åº¦
    max-header-size: 65536  # 64KB è¯·æ±‚å¤´å¤§å°
    max-chunk-size: 8192  # 8KB å—å¤§å°

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,refresh,configprops,unified-search
  endpoint:
    health:
      probes:
        enabled: true

spring:
  # åº”ç”¨ç¨‹åºé…ç½®
  application:
    name: ElasticProxyServer
  # ç¼–ç é…ç½®
  http:
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  # WebFluxé…ç½® - æ”¯æŒå¤§è¯·æ±‚ä½“ï¼ˆå¦‚_bulkæ“ä½œï¼‰
  webflux:
    multipart:
      max-in-memory-size: 67108864  # 64MB - æ”¯æŒå¤§bulkæ“ä½œ
  # Elasticsearchè¿æ¥é…ç½®
  elasticsearch:
    uris: http://172.168.0.100:19200
    username: elastic
    password: ***
    connection-timeout: 3s
    socket-timeout: 30s

elasticsearch:
  url: http://172.168.0.100:19200
  username: "elastic"
  password: "***"
  requestTimeoutSeconds: 45
  maxConnections: 200
  pendingAcquireMaxCount: 10000
  pendingAcquireTimeoutSeconds: 10
  connectTimeoutMillis: 5000
  maxIdleTimeSeconds: 30
  maxLifeTimeSeconds: 600
  clusters:
    logs:
      url: http://172.168.0.100:19200
      username: "elastic"
      password: "***"
    metrics:
      url: http://172.168.0.100:19200
      username: "elastic"
      password: "***"

proxy:
  logLevel: INFO
  useElasticsearchMonitoring: true
  # ç›‘æ§ç›¸å…³è¶…æ—¶é…ç½®
  monitoringTimeoutSeconds: 15
  monitoringRetryAttempts: 2
  allowList: ["127.0.0.1", "::1", "10.0.0.0/24","192.168.65.0/24","172.168.0.0/24"]
  blockList: []
  limits:
    rateLimit: 100/minute
    maxResultWindow: 10000
    maxQueryDepth: 5
    maxAggregationSize: 500
    maxSearchTerms: 1000
    allowPrefixWildcard: false
    strictQueryValidation: false
    maxQueryComplexity: 100
    allowRegexpQuery: false
    regexpMaxLength: 50 
  unified-search:
    # === åŸºç¡€é…ç½® ===
    enabled: true
    defaultMatchAnalyzer: "standard"
    maxConditions: 50
    timeoutSeconds: 30
    rangeFields: ["date", "time", "timestamp", "created", "updated", "bizDate", "biz_date", "price", "amount", "count", "quantity", "age", "score", "version"]
    exactMatchFields: ["id", "code", "status", "type", "category", "corpid", "corp_id", "userId", "user_id", "orderId", "order_id", "transactionId", "transaction_id"]
    # === v1.3.6 åŠŸèƒ½ ===
    # ç´¢å¼•è®¿é—®æ§åˆ¶ - é™åˆ¶å¯è®¿é—®çš„ç´¢å¼•æ¨¡å¼
    allowedIndices: ["test1", "elastic-proxy-logs-*", "logs-*", "metrics-*", "business-*"]
    # æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½ - å¯ç”¨æŸ¥è¯¢ç»“æœç¼“å­˜
    enableQueryCache: true
    queryCacheTtlSeconds: 300
    
    # === v1.3.7 åŠŸèƒ½ ===
    # ä¸¥æ ¼ç±»å‹æ£€æµ‹æ¨¡å¼ - æ§åˆ¶æŸ¥è¯¢ç±»å‹æ¨æ–­ç­–ç•¥
    strictTypeDetection: false
    # æŸ¥è¯¢æ—¥å¿—è®°å½• - è¯¦ç»†çš„ç»Ÿä¸€æœç´¢æŸ¥è¯¢å®¡è®¡
    enableQueryLogging: true
    # æ€§èƒ½æŒ‡æ ‡æ”¶é›† - åŸºäºMicrometerçš„ä¸“ä¸šçº§æ€§èƒ½ç›‘æ§
    enablePerformanceMetrics: true
  
  # ==================== ğŸ†• å¤šç§Ÿæˆ·é…ç½® ====================
  multi-tenant:
    # å¤šç§Ÿæˆ·åŠŸèƒ½å¼€å…³ï¼ˆé»˜è®¤å…³é—­ï¼Œä¿æŒå‘åå…¼å®¹ï¼‰
    enabled: false
    
    # é»˜è®¤ç§Ÿæˆ·é…ç½®
    defaultTenant: "default"
    
    # ä¸¥æ ¼éš”ç¦»æ¨¡å¼ï¼ˆtrue=å¼ºåˆ¶Basicè®¤è¯ï¼Œfalse=å…è®¸åŒ¿åè®¿é—®ä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
    strictTenantIsolation: true
    
    # æ˜¯å¦å…è®¸åŒ¿åè®¿é—®ï¼ˆä½¿ç”¨é»˜è®¤ç§Ÿæˆ·é…ç½®ï¼‰
    allowAnonymousAccess: false
    
    # ç§Ÿæˆ·è§£æè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    tenantResolutionTimeoutMs: 1000
    
    # ç§Ÿæˆ·ç¼“å­˜é…ç½®
    cache:
      # ç§Ÿæˆ·ä¸Šä¸‹æ–‡ç¼“å­˜æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
      tenantContextTtlMinutes: 15
      # æœ€å¤§ç¼“å­˜ç§Ÿæˆ·æ•°é‡
      maxCachedTenants: 1000
      # Basicè®¤è¯ç»“æœç¼“å­˜æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
      basicAuthCacheTtlMinutes: 30
    
  # ç§Ÿæˆ·å®šä¹‰ï¼ˆé»˜è®¤ä¸ºç©ºï¼Œå¯ç”¨å¤šç§Ÿæˆ·æ—¶éœ€è¦é…ç½®ï¼‰
  tenants: {}

# æ—¥å¿—é…ç½®
logging:
  level:
    com.yogoosoft.elasticproxy: INFO
    root: INFO